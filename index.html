<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Forum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .forum-container {
            max-width: 1200px;
        }
        .message-appear {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator span {
            animation: blink 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0% { opacity: 0.1; }
            20% { opacity: 1; }
            100% { opacity: 0.1; }
        }
        .form-appear {
            animation: formSlide 0.4s ease-out;
        }
        @keyframes formSlide {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Responsive improvements */
        @media (max-width: 768px) {
            .mobile-menu-hidden {
                display: none;
            }
            .mobile-full-width {
                width: 100% !important;
            }
            .mobile-mt-4 {
                margin-top: 1rem;
            }
            .mobile-px-2 {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        /* Improved scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* Thread hover effect */
        .thread-card {
            transition: all 0.2s ease;
        }
        .thread-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
                </svg>
                <h1 class="text-2xl font-bold">Real Time Forum</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span id="online-count" class="text-sm bg-green-500 px-2 py-1 rounded-full hidden sm:inline-block">5 online</span>
                <div id="auth-buttons" class="flex space-x-2">
                    <button id="login-button" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-md text-sm transition">Login</button>
                    <button id="register-button" class="bg-white text-indigo-700 hover:bg-gray-100 px-3 py-1 rounded-md text-sm font-medium transition">Register</button>
                </div>
                <div class="relative hidden" id="user-menu-container">
                    <button id="user-menu-button" class="flex items-center space-x-1 focus:outline-none">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-sm font-semibold" id="user-avatar">JS</div>
                        <span id="username-display" class="hidden sm:inline-block">Guest</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden">
                        <button id="edit-profile-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left">Edit Profile</button>
                        <button id="logout-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left">Logout</button>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="bg-indigo-800 text-white py-2 px-4 md:hidden hidden">
        <div class="space-y-2">
            <div class="font-medium text-lg pb-2 border-b border-indigo-700">Categories</div>
            <button class="mobile-category-btn w-full text-left py-2 rounded-md bg-indigo-700 px-3" data-category="general">
                General Discussion
            </button>
            <button class="mobile-category-btn w-full text-left py-2 rounded-md hover:bg-indigo-700 px-3" data-category="tech">
                Technology
            </button>
            <button class="mobile-category-btn w-full text-left py-2 rounded-md hover:bg-indigo-700 px-3" data-category="random">
                Random
            </button>
            <button class="mobile-category-btn w-full text-left py-2 rounded-md hover:bg-indigo-700 px-3" data-category="help">
                Help & Support
            </button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md form-appear mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Login to Real Time Forum</h2>
                <button id="close-login-modal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="login-error" class="mb-4 text-red-500 text-sm hidden"></div>
            <div class="mb-4">
                <label for="login-identifier" class="block text-sm font-medium text-gray-700 mb-1">Email or Nickname</label>
                <input type="text" id="login-identifier" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your email or nickname">
            </div>
            <div class="mb-6">
                <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="login-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your password">
            </div>
            <button id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">Login</button>
            <p class="mt-4 text-center text-sm text-gray-600">
                Don't have an account? 
                <button id="switch-to-register" class="text-blue-600 hover:text-blue-800 font-medium">Register</button>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md form-appear overflow-y-auto max-h-[90vh] mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Create an Account</h2>
                <button id="close-register-modal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="register-error" class="mb-4 text-red-500 text-sm hidden"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="register-firstname" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                    <input type="text" id="register-firstname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="First name">
                </div>
                <div>
                    <label for="register-lastname" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                    <input type="text" id="register-lastname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Last name">
                </div>
            </div>
            <div class="mb-4">
                <label for="register-nickname" class="block text-sm font-medium text-gray-700 mb-1">Nickname *</label>
                <input type="text" id="register-nickname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Choose a unique nickname">
            </div>
            <div class="mb-4">
                <label for="register-email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                <input type="email" id="register-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your email address">
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="register-age" class="block text-sm font-medium text-gray-700 mb-1">Age *</label>
                    <input type="number" id="register-age" min="13" max="120" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your age">
                </div>
                <div>
                    <label for="register-gender" class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
                    <select id="register-gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
            </div>
            <div class="mb-4">
                <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
                <input type="password" id="register-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Create a password">
                <p class="text-xs text-gray-500 mt-1">Password must be at least 8 characters long</p>
            </div>
            <div class="mb-6">
                <label for="register-confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password *</label>
                <input type="password" id="register-confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Confirm your password">
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Choose Avatar Color</label>
                <div class="flex space-x-2">
                    <button class="w-8 h-8 rounded-full bg-blue-500 focus:outline-none ring-2 ring-offset-2 ring-blue-500" data-color="blue-500"></button>
                    <button class="w-8 h-8 rounded-full bg-green-500 focus:outline-none" data-color="green-500"></button>
                    <button class="w-8 h-8 rounded-full bg-purple-500 focus:outline-none" data-color="purple-500"></button>
                    <button class="w-8 h-8 rounded-full bg-red-500 focus:outline-none" data-color="red-500"></button>
                    <button class="w-8 h-8 rounded-full bg-yellow-500 focus:outline-none" data-color="yellow-500"></button>
                </div>
            </div>
            <button id="register-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">Create Account</button>
            <p class="mt-4 text-center text-sm text-gray-600">
                Already have an account? 
                <button id="switch-to-login" class="text-blue-600 hover:text-blue-800 font-medium">Login</button>
            </p>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md overflow-y-auto max-h-[90vh] mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Edit Profile</h2>
                <button id="close-profile-modal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="edit-firstname" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <input type="text" id="edit-firstname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="edit-lastname" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                    <input type="text" id="edit-lastname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="mb-4">
                <label for="edit-nickname" class="block text-sm font-medium text-gray-700 mb-1">Nickname</label>
                <input type="text" id="edit-nickname" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="edit-age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                    <input type="number" id="edit-age" min="13" max="120" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="edit-gender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                    <select id="edit-gender" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Avatar Color</label>
                <div class="flex space-x-2">
                    <button class="w-8 h-8 rounded-full bg-blue-500 focus:outline-none" data-edit-color="blue-500"></button>
                    <button class="w-8 h-8 rounded-full bg-green-500 focus:outline-none" data-edit-color="green-500"></button>
                    <button class="w-8 h-8 rounded-full bg-purple-500 focus:outline-none" data-edit-color="purple-500"></button>
                    <button class="w-8 h-8 rounded-full bg-red-500 focus:outline-none" data-edit-color="red-500"></button>
                    <button class="w-8 h-8 rounded-full bg-yellow-500 focus:outline-none" data-edit-color="yellow-500"></button>
                </div>
            </div>
            <button id="save-profile-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">Save Changes</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="forum-content" class="hidden">
        <main class="container mx-auto px-4 py-6 forum-container">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Left Sidebar -->
                <div class="lg:w-1/4 hidden md:block">
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                        <h2 class="font-bold text-lg mb-3 text-gray-800">Categories</h2>
                        <ul class="space-y-2">
                            <li>
                                <button class="category-btn w-full text-left px-3 py-2 rounded-md bg-blue-100 text-blue-800 font-medium" data-category="general">
                                    General Discussion
                                </button>
                            </li>
                            <li>
                                <button class="category-btn w-full text-left px-3 py-2 rounded-md hover:bg-gray-100" data-category="tech">
                                    Technology
                                </button>
                            </li>
                            <li>
                                <button class="category-btn w-full text-left px-3 py-2 rounded-md hover:bg-gray-100" data-category="random">
                                    Random
                                </button>
                            </li>
                            <li>
                                <button class="category-btn w-full text-left px-3 py-2 rounded-md hover:bg-gray-100" data-category="help">
                                    Help & Support
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <h2 class="font-bold text-lg mb-3 text-gray-800">Online Users</h2>
                        <ul id="online-users-list" class="space-y-2">
                            <li class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white">JD</div>
                                <span>John Doe</span>
                            </li>
                            <li class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white">AS</div>
                                <span>Alice Smith</span>
                            </li>
                            <li class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white">RJ</div>
                                <span>Robert Johnson</span>
                            </li>
                            <li class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white">EW</div>
                                <span>Emma Wilson</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="lg:w-2/4 w-full">
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h1 class="text-xl font-bold text-gray-800" id="current-category">General Discussion</h1>
                            <button id="new-thread-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                                Create Post
                            </button>
                        </div>
                        
                        <div id="thread-form" class="mb-6 hidden">
                            <input type="text" id="thread-title" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Post title">
                            <textarea id="thread-content" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 h-24" placeholder="What's on your mind?"></textarea>
                            <div class="flex justify-end space-x-2">
                                <button id="cancel-thread-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                                <button id="post-thread-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Post</button>
                            </div>
                        </div>

                        <div id="threads-container" class="space-y-4">
                            <!-- Thread items will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Thread Detail View (initially hidden) -->
                    <div id="thread-detail" class="bg-white rounded-lg shadow-sm p-4 hidden">
                        <div class="mb-4">
                            <button id="back-to-threads" class="text-blue-600 hover:text-blue-800 flex items-center mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                </svg>
                                Back to posts
                            </button>
                            <h2 id="thread-detail-title" class="text-xl font-bold text-gray-800"></h2>
                            <div class="flex items-center space-x-2 text-sm text-gray-500 mt-1">
                                <div id="thread-detail-avatar" class="w-6 h-6 rounded-full flex items-center justify-center text-xs text-white"></div>
                                <span id="thread-detail-author"></span>
                                <span>•</span>
                                <span id="thread-detail-time"></span>
                            </div>
                        </div>
                        <div id="thread-detail-content" class="text-gray-700 mb-6 pb-6 border-b"></div>
                        
                        <div id="thread-replies" class="space-y-4 mb-6">
                            <!-- Replies will be dynamically added here -->
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-md">
                            <h3 class="font-medium text-gray-800 mb-2">Post a reply</h3>
                            <textarea id="reply-content" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-3 focus:outline-none focus:ring-2 focus:ring-blue-500 h-20" placeholder="Write your reply..."></textarea>
                            <div class="flex justify-end">
                                <button id="post-reply-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Post Reply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar - Private Messages -->
                <div class="lg:w-1/4 hidden md:block">
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="font-bold text-lg text-gray-800">Private Messages</h2>
                            <button id="new-message-btn" class="text-blue-600 hover:text-blue-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                        <div id="conversations-list" class="space-y-2">
                            <!-- Conversation items will be dynamically added here -->
                        </div>
                    </div>

                    <!-- New Message Modal -->
                    <div id="new-message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-gray-800">New Message</h2>
                                <button id="close-message-modal" class="text-gray-500 hover:text-gray-700">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            <div class="mb-4">
                                <label for="message-recipient" class="block text-sm font-medium text-gray-700 mb-1">To:</label>
                                <select id="message-recipient" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select a user</option>
                                    <!-- User options will be dynamically added here -->
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="message-content" class="block text-sm font-medium text-gray-700 mb-1">Message:</label>
                                <textarea id="message-content" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-32" placeholder="Type your message here..."></textarea>
                            </div>
                            <button id="send-message-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">Send Message</button>
                        </div>
                    </div>

                    <!-- Chat Window (initially hidden) -->
                    <div id="chat-window" class="bg-white rounded-lg shadow-sm hidden">
                        <div class="p-3 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
                            <div class="flex items-center space-x-2">
                                <div id="chat-avatar" class="w-8 h-8 rounded-full flex items-center justify-center text-white"></div>
                                <span id="chat-username" class="font-medium"></span>
                            </div>
                            <button id="close-chat" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div id="chat-messages" class="p-3 h-80 overflow-y-auto space-y-3">
                            <!-- Chat messages will be dynamically added here -->
                        </div>
                        <div class="p-3 border-t">
                            <div class="flex items-center space-x-2">
                                <input type="text" id="chat-input" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type a message...">
                                <button id="send-chat-btn" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                    </svg>
                                </button>
                            </div>
                            <div id="typing-indicator" class="text-xs text-gray-500 mt-1 hidden">
                                <span class="typing-indicator">
                                    <span>.</span><span>.</span><span>.</span>
                                </span>
                                <span>typing</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile bottom navigation -->
            <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 md:hidden z-10">
                <button id="mobile-home-btn" class="flex flex-col items-center text-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="text-xs">Home</span>
                </button>
                <button id="mobile-categories-btn" class="flex flex-col items-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <span class="text-xs">Categories</span>
                </button>
                <button id="mobile-new-post-btn" class="flex flex-col items-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    <span class="text-xs">New Post</span>
                </button>
                <button id="mobile-messages-btn" class="flex flex-col items-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                    <span class="text-xs">Messages</span>
                </button>
                <button id="mobile-profile-btn" class="flex flex-col items-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </main>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6 md:p-8">
                <h1 class="text-2xl md:text-3xl font-bold mb-2">Welcome to Real Time Forum</h1>
                <p class="text-base md:text-lg opacity-90">Join our community and start discussing topics that matter to you.</p>
            </div>
            <div class="p-6 md:p-8">
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/2">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">Why Join Real Time Forum?</h2>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Connect with like-minded individuals</span>
                            </li>
                            <li class="flex items-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Participate in real-time discussions</span>
                            </li>
                            <li class="flex items-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Send private messages to other members</span>
                            </li>
                            <li class="flex items-start">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Create and follow interesting topics</span>
                            </li>
                        </ul>
                    </div>
                    <div class="md:w-1/2 mt-6 md:mt-0">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">Popular Categories</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="bg-blue-50 p-3 rounded-md">
                                <h3 class="font-medium text-blue-800">General Discussion</h3>
                                <p class="text-sm text-gray-600">12 active threads</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-md">
                                <h3 class="font-medium text-purple-800">Technology</h3>
                                <p class="text-sm text-gray-600">8 active threads</p>
                            </div>
                            <div class="bg-green-50 p-3 rounded-md">
                                <h3 class="font-medium text-green-800">Random</h3>
                                <p class="text-sm text-gray-600">5 active threads</p>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded-md">
                                <h3 class="font-medium text-yellow-800">Help & Support</h3>
                                <p class="text-sm text-gray-600">3 active threads</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">Get Started Now</h2>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button id="welcome-login-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-md transition duration-200">Login</button>
                        <button id="welcome-register-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-md transition duration-200">Create an Account</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Messages Panel (initially hidden) -->
    <div id="mobile-messages-panel" class="fixed inset-0 bg-white z-20 hidden overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center">
            <h2 class="text-lg font-bold">Private Messages</h2>
            <button id="close-mobile-messages" class="text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="p-4">
            <button id="mobile-new-message-btn" class="w-full bg-blue-600 text-white py-2 rounded-md mb-4 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                New Message
            </button>
            <div id="mobile-conversations-list" class="space-y-2">
                <!-- Mobile conversation items will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Mobile Chat Panel (initially hidden) -->
    <div id="mobile-chat-panel" class="fixed inset-0 bg-white z-20 hidden flex flex-col">
        <div class="sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div id="mobile-chat-avatar" class="w-8 h-8 rounded-full flex items-center justify-center text-white"></div>
                <span id="mobile-chat-username" class="font-medium"></span>
            </div>
            <button id="close-mobile-chat" class="text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="mobile-chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3">
            <!-- Mobile chat messages will be dynamically added here -->
        </div>
        <div class="border-t border-gray-200 p-4">
            <div class="flex items-center space-x-2">
                <input type="text" id="mobile-chat-input" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type a message...">
                <button id="mobile-send-chat-btn" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>
            <div id="mobile-typing-indicator" class="text-xs text-gray-500 mt-1 hidden">
                <span class="typing-indicator">
                    <span>.</span><span>.</span><span>.</span>
                </span>
                <span>typing</span>
            </div>
        </div>
    </div>

    <!-- Floating Logout Button (visible when logged in) -->
    <div id="floating-logout" class="fixed bottom-20 right-4 hidden md:block">
        <button id="floating-logout-btn" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-300 rounded-md shadow-md flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
            Logout
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // User state
            let currentUser = null;
            let currentCategory = 'general';
            let currentThreadId = null;
            let conversations = [];
            let currentChatUser = null;
            let selectedAvatarColor = 'blue-500';
            let isMobileMenuOpen = false;
            
            // Sample data - registered users
            const registeredUsers = [
                { 
                    id: 1, 
                    firstName: 'John',
                    lastName: 'Doe',
                    nickname: 'JohnD',
                    email: 'john@example.com',
                    age: 28,
                    gender: 'male',
                    password: 'password123',
                    color: 'green-500', 
                    initials: 'JD' 
                },
                { 
                    id: 2, 
                    firstName: 'Alice',
                    lastName: 'Smith',
                    nickname: 'AliceS',
                    email: 'alice@example.com',
                    age: 32,
                    gender: 'female',
                    password: 'password123',
                    color: 'blue-500', 
                    initials: 'AS' 
                },
                { 
                    id: 3, 
                    firstName: 'Robert',
                    lastName: 'Johnson',
                    nickname: 'RobJ',
                    email: 'robert@example.com',
                    age: 25,
                    gender: 'male',
                    password: 'password123',
                    color: 'purple-500', 
                    initials: 'RJ' 
                },
                { 
                    id: 4, 
                    firstName: 'Emma',
                    lastName: 'Wilson',
                    nickname: 'EmmaW',
                    email: 'emma@example.com',
                    age: 30,
                    gender: 'female',
                    password: 'password123',
                    color: 'red-500', 
                    initials: 'EW' 
                }
            ];
            
            const categories = {
                general: {
                    threads: [
                        {
                            id: 1,
                            title: 'Welcome to the forum!',
                            content: 'Hello everyone! This is our new real-time forum. Feel free to introduce yourself and start discussions.',
                            author: 'JohnD',
                            authorColor: 'green-500',
                            authorInitials: 'JD',
                            time: '2 hours ago',
                            replies: [
                                {
                                    id: 1,
                                    content: 'Thanks for creating this! Looking forward to great discussions.',
                                    author: 'AliceS',
                                    authorColor: 'blue-500',
                                    authorInitials: 'AS',
                                    time: '1 hour ago'
                                },
                                {
                                    id: 2,
                                    content: 'Hello everyone! I\'m new here and excited to join the community.',
                                    author: 'RobJ',
                                    authorColor: 'purple-500',
                                    authorInitials: 'RJ',
                                    time: '45 minutes ago'
                                }
                            ]
                        },
                        {
                            id: 2,
                            title: 'Forum rules and guidelines',
                            content: 'Please make sure to follow these basic rules:\n1. Be respectful to others\n2. No spam or self-promotion\n3. Use appropriate language\n4. Stay on topic',
                            author: 'EmmaW',
                            authorColor: 'red-500',
                            authorInitials: 'EW',
                            time: '1 day ago',
                            replies: []
                        }
                    ]
                },
                tech: {
                    threads: [
                        {
                            id: 3,
                            title: 'What\'s your favorite programming language?',
                            content: 'I\'m curious to know what programming languages everyone prefers and why. Personally, I\'ve been using JavaScript a lot lately.',
                            author: 'RobJ',
                            authorColor: 'purple-500',
                            authorInitials: 'RJ',
                            time: '3 hours ago',
                            replies: []
                        }
                    ]
                },
                random: {
                    threads: []
                },
                help: {
                    threads: []
                }
            };
            
            // Initialize private messages
            conversations = [
                {
                    id: 1,
                    with: 'JohnD',
                    withColor: 'green-500',
                    withInitials: 'JD',
                    lastMessage: 'Hey, how are you doing?',
                    time: '10 min ago',
                    unread: true,
                    messages: [
                        {
                            sender: 'JohnD',
                            content: 'Hey, how are you doing?',
                            time: '10 min ago'
                        }
                    ]
                },
                {
                    id: 2,
                    with: 'AliceS',
                    withColor: 'blue-500',
                    withInitials: 'AS',
                    lastMessage: 'Did you see the new forum feature?',
                    time: '1 hour ago',
                    unread: false,
                    messages: [
                        {
                            sender: 'AliceS',
                            content: 'Hi there!',
                            time: '1 hour ago'
                        },
                        {
                            sender: 'AliceS',
                            content: 'Did you see the new forum feature?',
                            time: '1 hour ago'
                        }
                    ]
                }
            ];

            // DOM Elements
            const welcomeScreen = document.getElementById('welcome-screen');
            const forumContent = document.getElementById('forum-content');
            const loginModal = document.getElementById('login-modal');
            const registerModal = document.getElementById('register-modal');
            const loginButton = document.getElementById('login-button');
            const registerButton = document.getElementById('register-button');
            const welcomeLoginBtn = document.getElementById('welcome-login-btn');
            const welcomeRegisterBtn = document.getElementById('welcome-register-btn');
            const closeLoginModal = document.getElementById('close-login-modal');
            const closeRegisterModal = document.getElementById('close-register-modal');
            const switchToRegister = document.getElementById('switch-to-register');
            const switchToLogin = document.getElementById('switch-to-login');
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const loginIdentifier = document.getElementById('login-identifier');
            const loginPassword = document.getElementById('login-password');
            const registerNickname = document.getElementById('register-nickname');
            const registerEmail = document.getElementById('register-email');
            const registerPassword = document.getElementById('register-password');
            const registerConfirmPassword = document.getElementById('register-confirm-password');
            const registerFirstname = document.getElementById('register-firstname');
            const registerLastname = document.getElementById('register-lastname');
            const registerAge = document.getElementById('register-age');
            const registerGender = document.getElementById('register-gender');
            const loginError = document.getElementById('login-error');
            const registerError = document.getElementById('register-error');
            const authButtons = document.getElementById('auth-buttons');
            const userMenuContainer = document.getElementById('user-menu-container');
            const userMenuButton = document.getElementById('user-menu-button');
            const userDropdown = document.getElementById('user-dropdown');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const profileModal = document.getElementById('profile-modal');
            const closeProfileModal = document.getElementById('close-profile-modal');
            const editNickname = document.getElementById('edit-nickname');
            const editFirstname = document.getElementById('edit-firstname');
            const editLastname = document.getElementById('edit-lastname');
            const editAge = document.getElementById('edit-age');
            const editGender = document.getElementById('edit-gender');
            const saveProfileBtn = document.getElementById('save-profile-btn');
            const userAvatar = document.getElementById('user-avatar');
            const usernameDisplay = document.getElementById('username-display');
            const categoryBtns = document.querySelectorAll('.category-btn');
            const mobileCategoryBtns = document.querySelectorAll('.mobile-category-btn');
            const currentCategoryEl = document.getElementById('current-category');
            const threadsContainer = document.getElementById('threads-container');
            const newThreadBtn = document.getElementById('new-thread-btn');
            const threadForm = document.getElementById('thread-form');
            const threadTitle = document.getElementById('thread-title');
            const threadContent = document.getElementById('thread-content');
            const cancelThreadBtn = document.getElementById('cancel-thread-btn');
            const postThreadBtn = document.getElementById('post-thread-btn');
            const threadDetail = document.getElementById('thread-detail');
            const threadDetailTitle = document.getElementById('thread-detail-title');
            const threadDetailAvatar = document.getElementById('thread-detail-avatar');
            const threadDetailAuthor = document.getElementById('thread-detail-author');
            const threadDetailTime = document.getElementById('thread-detail-time');
            const threadDetailContent = document.getElementById('thread-detail-content');
            const threadReplies = document.getElementById('thread-replies');
            const backToThreads = document.getElementById('back-to-threads');
            const replyContent = document.getElementById('reply-content');
            const postReplyBtn = document.getElementById('post-reply-btn');
            const conversationsList = document.getElementById('conversations-list');
            const newMessageBtn = document.getElementById('new-message-btn');
            const newMessageModal = document.getElementById('new-message-modal');
            const closeMessageModal = document.getElementById('close-message-modal');
            const messageRecipient = document.getElementById('message-recipient');
            const messageContent = document.getElementById('message-content');
            const sendMessageBtn = document.getElementById('send-message-btn');
            const chatWindow = document.getElementById('chat-window');
            const chatAvatar = document.getElementById('chat-avatar');
            const chatUsername = document.getElementById('chat-username');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendChatBtn = document.getElementById('send-chat-btn');
            const closeChat = document.getElementById('close-chat');
            const typingIndicator = document.getElementById('typing-indicator');
            const onlineUsersList = document.getElementById('online-users-list');
            const onlineCount = document.getElementById('online-count');
            const floatingLogout = document.getElementById('floating-logout');
            const floatingLogoutBtn = document.getElementById('floating-logout-btn');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileHomeBtn = document.getElementById('mobile-home-btn');
            const mobileCategoriesBtn = document.getElementById('mobile-categories-btn');
            const mobileNewPostBtn = document.getElementById('mobile-new-post-btn');
            const mobileMessagesBtn = document.getElementById('mobile-messages-btn');
            const mobileProfileBtn = document.getElementById('mobile-profile-btn');
            const mobileMessagesPanel = document.getElementById('mobile-messages-panel');
            const closeMobileMessages = document.getElementById('close-mobile-messages');
            const mobileNewMessageBtn = document.getElementById('mobile-new-message-btn');
            const mobileConversationsList = document.getElementById('mobile-conversations-list');
            const mobileChatPanel = document.getElementById('mobile-chat-panel');
            const mobileChatAvatar = document.getElementById('mobile-chat-avatar');
            const mobileChatUsername = document.getElementById('mobile-chat-username');
            const mobileChatMessages = document.getElementById('mobile-chat-messages');
            const mobileChatInput = document.getElementById('mobile-chat-input');
            const mobileSendChatBtn = document.getElementById('mobile-send-chat-btn');
            const closeMobileChat = document.getElementById('close-mobile-chat');
            const mobileTypingIndicator = document.getElementById('mobile-typing-indicator');

            // Initialize the forum
            function init() {
                checkLoggedInUser();
                renderThreads();
                renderConversations();
                populateMessageRecipients();
                
                // Simulate random online count changes
                setInterval(() => {
                    const count = Math.floor(Math.random() * 3) + 4; // 4-6 users
                    onlineCount.textContent = `${count} online`;
                }, 30000);
            }

            // Check if user is logged in
            function checkLoggedInUser() {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    showLoggedInUI();
                } else {
                    showLoggedOutUI();
                }
            }

            // Show UI for logged in users
            function showLoggedInUI() {
                welcomeScreen.classList.add('hidden');
                forumContent.classList.remove('hidden');
                authButtons.classList.add('hidden');
                userMenuContainer.classList.remove('hidden');
                floatingLogout.classList.remove('hidden');
                
                // Update user info in UI
                usernameDisplay.textContent = currentUser.nickname;
                userAvatar.textContent = currentUser.initials;
                userAvatar.className = `w-8 h-8 rounded-full bg-${currentUser.color} flex items-center justify-center text-sm font-semibold`;
                
                // Add current user to online users
                updateOnlineUsersList();
            }

            // Show UI for logged out users
            function showLoggedOutUI() {
                welcomeScreen.classList.remove('hidden');
                forumContent.classList.add('hidden');
                authButtons.classList.remove('hidden');
                userMenuContainer.classList.add('hidden');
                floatingLogout.classList.add('hidden');
                mobileMenu.classList.add('hidden');
                mobileMessagesPanel.classList.add('hidden');
                mobileChatPanel.classList.add('hidden');
            }

            // Update online users list
            function updateOnlineUsersList() {
                onlineUsersList.innerHTML = '';
                
                // Add current user first
                if (currentUser) {
                    const userItem = document.createElement('li');
                    userItem.className = 'flex items-center space-x-2';
                    userItem.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-${currentUser.color} flex items-center justify-center text-white">${currentUser.initials}</div>
                        <span>${currentUser.nickname}</span>
                        <span class="text-xs bg-green-500 text-white px-1 rounded ml-auto">You</span>
                    `;
                    onlineUsersList.appendChild(userItem);
                }
                
                // Add other sample users
                registeredUsers.forEach(user => {
                    if (!currentUser || user.nickname !== currentUser.nickname) {
                        const userItem = document.createElement('li');
                        userItem.className = 'flex items-center space-x-2';
                        userItem.innerHTML = `
                            <div class="w-8 h-8 rounded-full bg-${user.color} flex items-center justify-center text-white">${user.initials}</div>
                            <span>${user.nickname}</span>
                        `;
                        onlineUsersList.appendChild(userItem);
                    }
                });
            }

            // Login functionality
            loginBtn.addEventListener('click', function() {
                const identifier = loginIdentifier.value.trim();
                const password = loginPassword.value.trim();
                
                if (!identifier || !password) {
                    showLoginError('Please enter both identifier and password.');
                    return;
                }
                
                // Find user by email or nickname
                const user = registeredUsers.find(u => 
                    (u.email === identifier || u.nickname === identifier) && u.password === password
                );
                
                if (user) {
                    // Login successful
                    currentUser = {
                        id: user.id,
                        firstName: user.firstName,
                        lastName: user.lastName,
                        nickname: user.nickname,
                        email: user.email,
                        age: user.age,
                        gender: user.gender,
                        color: user.color,
                        initials: user.initials
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Update UI
                    loginModal.classList.add('hidden');
                    showLoggedInUI();
                    
                    // Show notification
                    showNotification('Login successful!');
                } else {
                    showLoginError('Invalid email/nickname or password.');
                }
            });

            // Register functionality
            registerBtn.addEventListener('click', function() {
                const nickname = registerNickname.value.trim();
                const email = registerEmail.value.trim();
                const password = registerPassword.value.trim();
                const confirmPassword = registerConfirmPassword.value.trim();
                const firstName = registerFirstname.value.trim();
                const lastName = registerLastname.value.trim();
                const age = registerAge.value;
                const gender = registerGender.value;
                
                // Validate inputs
                if (!nickname || !email || !password || !confirmPassword || !firstName || !lastName || !age || !gender) {
                    showRegisterError('All fields are required.');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showRegisterError('Passwords do not match.');
                    return;
                }
                
                if (password.length < 8) {
                    showRegisterError('Password must be at least 8 characters long.');
                    return;
                }
                
                if (age < 13) {
                    showRegisterError('You must be at least 13 years old to register.');
                    return;
                }
                
                // Check if email or nickname already exists
                if (registeredUsers.some(u => u.email === email)) {
                    showRegisterError('Email already in use.');
                    return;
                }
                
                if (registeredUsers.some(u => u.nickname === nickname)) {
                    showRegisterError('Nickname already taken.');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: registeredUsers.length + 1,
                    firstName: firstName,
                    lastName: lastName,
                    nickname: nickname,
                    email: email,
                    age: parseInt(age),
                    gender: gender,
                    password: password,
                    color: selectedAvatarColor,
                    initials: getInitials(firstName + ' ' + lastName)
                };
                
                // Add to registered users
                registeredUsers.push(newUser);
                
                // Login the new user
                currentUser = {
                    id: newUser.id,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    nickname: newUser.nickname,
                    email: newUser.email,
                    age: newUser.age,
                    gender: newUser.gender,
                    color: newUser.color,
                    initials: newUser.initials
                };
                
                // Save to localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update UI
                registerModal.classList.add('hidden');
                showLoggedInUI();
                
                // Show notification
                showNotification('Registration successful!');
            });

            // Logout functionality
            function logoutUser() {
                // Clear current user
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Update UI
                showLoggedOutUI();
                
                // Close any open modals
                userDropdown.classList.add('hidden');
                
                // Show notification
                showNotification('Logged out successfully!');
            }

            logoutBtn.addEventListener('click', logoutUser);
            floatingLogoutBtn.addEventListener('click', logoutUser);

            // Avatar color selection
            document.querySelectorAll('[data-color]').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('[data-color]').forEach(btn => {
                        btn.classList.remove('ring-2', 'ring-offset-2');
                    });
                    this.classList.add('ring-2', 'ring-offset-2');
                    selectedAvatarColor = this.getAttribute('data-color');
                });
            });

            document.querySelectorAll('[data-edit-color]').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('[data-edit-color]').forEach(btn => {
                        btn.classList.remove('ring-2', 'ring-offset-2');
                    });
                    this.classList.add('ring-2', 'ring-offset-2');
                    currentUser.color = this.getAttribute('data-edit-color');
                });
            });

            // User menu functionality
            userMenuButton.addEventListener('click', function() {
                userDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', function(event) {
                if (!userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.add('hidden');
                }
            });

            // Edit profile functionality
            editProfileBtn.addEventListener('click', function() {
                editNickname.value = currentUser.nickname;
                editFirstname.value = currentUser.firstName;
                editLastname.value = currentUser.lastName;
                editAge.value = currentUser.age;
                editGender.value = currentUser.gender;
                
                document.querySelectorAll('[data-edit-color]').forEach(btn => {
                    btn.classList.remove('ring-2', 'ring-offset-2');
                    if (btn.getAttribute('data-edit-color') === currentUser.color) {
                        btn.classList.add('ring-2', 'ring-offset-2');
                    }
                });
                
                profileModal.classList.remove('hidden');
                userDropdown.classList.add('hidden');
            });

            closeProfileModal.addEventListener('click', function() {
                profileModal.classList.add('hidden');
            });

            saveProfileBtn.addEventListener('click', function() {
                const nickname = editNickname.value.trim();
                const firstName = editFirstname.value.trim();
                const lastName = editLastname.value.trim();
                const age = editAge.value;
                const gender = editGender.value;
                
                if (nickname && firstName && lastName && age && gender) {
                    // Check if nickname is already taken by another user
                    if (nickname !== currentUser.nickname && registeredUsers.some(u => u.nickname === nickname && u.id !== currentUser.id)) {
                        showNotification('Nickname already taken.', 'error');
                        return;
                    }
                    
                    // Update user data
                    currentUser.nickname = nickname;
                    currentUser.firstName = firstName;
                    currentUser.lastName = lastName;
                    currentUser.age = parseInt(age);
                    currentUser.gender = gender;
                    currentUser.initials = getInitials(firstName + ' ' + lastName);
                    
                    // Update in registeredUsers array
                    const userIndex = registeredUsers.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        registeredUsers[userIndex] = {
                            ...registeredUsers[userIndex],
                            nickname,
                            firstName,
                            lastName,
                            age: parseInt(age),
                            gender,
                            color: currentUser.color,
                            initials: currentUser.initials
                        };
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Update UI
                    usernameDisplay.textContent = currentUser.nickname;
                    userAvatar.textContent = currentUser.initials;
                    userAvatar.className = `w-8 h-8 rounded-full bg-${currentUser.color} flex items-center justify-center text-sm font-semibold`;
                    
                    // Update online users list
                    updateOnlineUsersList();
                    
                    profileModal.classList.add('hidden');
                    showNotification('Profile updated successfully!');
                }
            });

            // Modal controls
            loginButton.addEventListener('click', function() {
                loginModal.classList.remove('hidden');
                loginIdentifier.focus();
            });

            registerButton.addEventListener('click', function() {
                registerModal.classList.remove('hidden');
                registerNickname.focus();
            });

            welcomeLoginBtn.addEventListener('click', function() {
                loginModal.classList.remove('hidden');
                loginIdentifier.focus();
            });

            welcomeRegisterBtn.addEventListener('click', function() {
                registerModal.classList.remove('hidden');
                registerNickname.focus();
            });

            closeLoginModal.addEventListener('click', function() {
                loginModal.classList.add('hidden');
                clearLoginForm();
            });

            closeRegisterModal.addEventListener('click', function() {
                registerModal.classList.add('hidden');
                clearRegisterForm();
            });

            switchToRegister.addEventListener('click', function() {
                loginModal.classList.add('hidden');
                registerModal.classList.remove('hidden');
                registerNickname.focus();
                clearLoginForm();
            });

            switchToLogin.addEventListener('click', function() {
                registerModal.classList.add('hidden');
                loginModal.classList.remove('hidden');
                loginIdentifier.focus();
                clearRegisterForm();
            });

            // Form utilities
            function clearLoginForm() {
                loginIdentifier.value = '';
                loginPassword.value = '';
                loginError.classList.add('hidden');
            }

            function clearRegisterForm() {
                registerNickname.value = '';
                registerEmail.value = '';
                registerPassword.value = '';
                registerConfirmPassword.value = '';
                registerFirstname.value = '';
                registerLastname.value = '';
                registerAge.value = '';
                registerGender.value = '';
                registerError.classList.add('hidden');
            }

            function showLoginError(message) {
                loginError.textContent = message;
                loginError.classList.remove('hidden');
            }

            function showRegisterError(message) {
                registerError.textContent = message;
                registerError.classList.remove('hidden');
            }

            // Category switching
            function switchCategory(category) {
                currentCategory = category;
                currentCategoryEl.textContent = getCategoryName(category);
                
                // Update active category styling for desktop
                categoryBtns.forEach(b => {
                    b.classList.remove('bg-blue-100', 'text-blue-800', 'font-medium');
                    b.classList.add('hover:bg-gray-100');
                    if (b.getAttribute('data-category') === category) {
                        b.classList.add('bg-blue-100', 'text-blue-800', 'font-medium');
                        b.classList.remove('hover:bg-gray-100');
                    }
                });
                
                // Update active category styling for mobile
                mobileCategoryBtns.forEach(b => {
                    b.classList.remove('bg-indigo-700');
                    b.classList.add('hover:bg-indigo-700');
                    if (b.getAttribute('data-category') === category) {
                        b.classList.add('bg-indigo-700');
                        b.classList.remove('hover:bg-indigo-700');
                    }
                });
                
                renderThreads();
                
                // Hide thread detail if visible
                threadDetail.classList.add('hidden');
                document.getElementById('threads-container').parentElement.classList.remove('hidden');
                
                // Close mobile menu if open
                mobileMenu.classList.add('hidden');
                isMobileMenuOpen = false;
            }

            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    switchCategory(category);
                });
            });

            mobileCategoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    switchCategory(category);
                });
            });

            // New thread functionality
            function showNewThreadForm() {
                if (!currentUser) {
                    showNotification('Please login to create a post.', 'error');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                threadForm.classList.remove('hidden');
                threadTitle.focus();
            }

            newThreadBtn.addEventListener('click', showNewThreadForm);
            mobileNewPostBtn.addEventListener('click', showNewThreadForm);

            cancelThreadBtn.addEventListener('click', function() {
                threadForm.classList.add('hidden');
                threadTitle.value = '';
                threadContent.value = '';
            });

            postThreadBtn.addEventListener('click', function() {
                const title = threadTitle.value.trim();
                const content = threadContent.value.trim();
                
                if (title && content) {
                    // Create new thread
                    const newThread = {
                        id: Date.now(),
                        title: title,
                        content: content,
                        author: currentUser.nickname,
                        authorColor: currentUser.color,
                        authorInitials: currentUser.initials,
                        time: 'Just now',
                        replies: []
                    };
                    
                    // Add to category
                    if (!categories[currentCategory]) {
                        categories[currentCategory] = { threads: [] };
                    }
                    categories[currentCategory].threads.unshift(newThread);
                    
                    // Reset form and render
                    threadTitle.value = '';
                    threadContent.value = '';
                    threadForm.classList.add('hidden');
                    renderThreads();
                    
                    // Show notification
                    showNotification('Post created successfully!');
                }
            });

            // Thread detail view
            function showThreadDetail(threadId) {
                const thread = findThreadById(threadId);
                if (thread) {
                    currentThreadId = threadId;
                    threadDetailTitle.textContent = thread.title;
                    threadDetailAvatar.textContent = thread.authorInitials;
                    threadDetailAvatar.className = `w-6 h-6 rounded-full bg-${thread.authorColor} flex items-center justify-center text-xs text-white`;
                    threadDetailAuthor.textContent = thread.author;
                    threadDetailTime.textContent = thread.time;
                    threadDetailContent.textContent = thread.content;
                    
                    // Render replies
                    renderReplies(thread.replies);
                    
                    // Show thread detail, hide threads list
                    document.getElementById('threads-container').parentElement.classList.add('hidden');
                    threadDetail.classList.remove('hidden');
                }
            }

            backToThreads.addEventListener('click', function() {
                threadDetail.classList.add('hidden');
                document.getElementById('threads-container').parentElement.classList.remove('hidden');
                currentThreadId = null;
            });

            // Post reply functionality
            postReplyBtn.addEventListener('click', function() {
                if (!currentUser) {
                    showNotification('Please login to post a reply.', 'error');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                const content = replyContent.value.trim();
                
                if (content && currentThreadId) {
                    const thread = findThreadById(currentThreadId);
                    if (thread) {
                        // Create new reply
                        const newReply = {
                            id: Date.now(),
                            content: content,
                            author: currentUser.nickname,
                            authorColor: currentUser.color,
                            authorInitials: currentUser.initials,
                            time: 'Just now'
                        };
                        
                        // Add to thread
                        thread.replies.push(newReply);
                        
                        // Reset form and render
                        replyContent.value = '';
                        renderReplies(thread.replies);
                        
                        // Show notification
                        showNotification('Reply posted successfully!');
                        
                        // Scroll to bottom
                        threadReplies.scrollTop = threadReplies.scrollHeight;
                    }
                }
            });

            // Private messaging functionality
            function showNewMessageModal() {
                if (!currentUser) {
                    showNotification('Please login to send messages.', 'error');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                newMessageModal.classList.remove('hidden');
                mobileMessagesPanel.classList.add('hidden');
            }

            newMessageBtn.addEventListener('click', showNewMessageModal);
            mobileNewMessageBtn.addEventListener('click', showNewMessageModal);

            closeMessageModal.addEventListener('click', function() {
                newMessageModal.classList.add('hidden');
                messageContent.value = '';
                messageRecipient.value = '';
            });

            sendMessageBtn.addEventListener('click', function() {
                const recipient = messageRecipient.value;
                const content = messageContent.value.trim();
                
                if (recipient && content) {
                    const user = registeredUsers.find(u => u.nickname === recipient);
                    if (user) {
                        // Check if conversation exists
                        let conversation = conversations.find(c => c.with === user.nickname);
                        
                        if (!conversation) {
                            // Create new conversation
                            conversation = {
                                id: Date.now(),
                                with: user.nickname,
                                withColor: user.color,
                                withInitials: user.initials,
                                lastMessage: content,
                                time: 'Just now',
                                unread: false,
                                messages: []
                            };
                            conversations.unshift(conversation);
                        }
                        
                        // Add message
                        conversation.messages.push({
                            sender: currentUser.nickname,
                            content: content,
                            time: 'Just now'
                        });
                        
                        conversation.lastMessage = content;
                        conversation.time = 'Just now';
                        
                        // Reset form and render
                        messageContent.value = '';
                        messageRecipient.value = '';
                        newMessageModal.classList.add('hidden');
                        renderConversations();
                        renderMobileConversations();
                        
                        // Show notification
                        showNotification('Message sent successfully!');
                        
                        // Open chat window
                        openChat(conversation);
                    }
                }
            });

            // Chat window functionality
            function openChat(conversation) {
                currentChatUser = conversation.with;
                
                // Desktop chat
                chatAvatar.textContent = conversation.withInitials;
                chatAvatar.className = `w-8 h-8 rounded-full bg-${conversation.withColor} flex items-center justify-center text-white`;
                chatUsername.textContent = conversation.with;
                
                // Mobile chat
                mobileChatAvatar.textContent = conversation.withInitials;
                mobileChatAvatar.className = `w-8 h-8 rounded-full bg-${conversation.withColor} flex items-center justify-center text-white`;
                mobileChatUsername.textContent = conversation.with;
                
                // Mark as read
                conversation.unread = false;
                
                // Render messages
                renderChatMessages(conversation.messages);
                renderMobileChatMessages(conversation.messages);
                
                // Show chat window
                chatWindow.classList.remove('hidden');
                mobileChatPanel.classList.remove('hidden');
                mobileMessagesPanel.classList.add('hidden');
                
                // Focus input
                chatInput.focus();
                mobileChatInput.focus();
                
                // Update conversations list
                renderConversations();
                renderMobileConversations();
            }

            closeChat.addEventListener('click', function() {
                chatWindow.classList.add('hidden');
                currentChatUser = null;
            });

            closeMobileChat.addEventListener('click', function() {
                mobileChatPanel.classList.add('hidden');
                mobileMessagesPanel.classList.remove('hidden');
                currentChatUser = null;
            });

            sendChatBtn.addEventListener('click', function() {
                sendChatMessage();
            });

            mobileSendChatBtn.addEventListener('click', function() {
                sendMobileChatMessage();
            });

            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            mobileChatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMobileChatMessage();
                }
            });

            function sendChatMessage() {
                if (!currentUser) {
                    showNotification('Please login to send messages.', 'error');
                    chatWindow.classList.add('hidden');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                const content = chatInput.value.trim();
                
                if (content && currentChatUser) {
                    const conversation = conversations.find(c => c.with === currentChatUser);
                    if (conversation) {
                        // Add message
                        conversation.messages.push({
                            sender: currentUser.nickname,
                            content: content,
                            time: 'Just now'
                        });
                        
                        conversation.lastMessage = content;
                        conversation.time = 'Just now';
                        
                        // Reset input and render
                        chatInput.value = '';
                        renderChatMessages(conversation.messages);
                        renderMobileChatMessages(conversation.messages);
                        renderConversations();
                        renderMobileConversations();
                        
                        // Simulate reply after delay
                        simulateTyping();
                        setTimeout(() => {
                            simulateReply(conversation);
                        }, 3000);
                    }
                }
            }

            function sendMobileChatMessage() {
                if (!currentUser) {
                    showNotification('Please login to send messages.', 'error');
                    mobileChatPanel.classList.add('hidden');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                const content = mobileChatInput.value.trim();
                
                if (content && currentChatUser) {
                    const conversation = conversations.find(c => c.with === currentChatUser);
                    if (conversation) {
                        // Add message
                        conversation.messages.push({
                            sender: currentUser.nickname,
                            content: content,
                            time: 'Just now'
                        });
                        
                        conversation.lastMessage = content;
                        conversation.time = 'Just now';
                        
                        // Reset input and render
                        mobileChatInput.value = '';
                        renderChatMessages(conversation.messages);
                        renderMobileChatMessages(conversation.messages);
                        renderConversations();
                        renderMobileConversations();
                        
                        // Simulate reply after delay
                        simulateTyping();
                        setTimeout(() => {
                            simulateReply(conversation);
                        }, 3000);
                    }
                }
            }

            function simulateTyping() {
                typingIndicator.classList.remove('hidden');
                mobileTypingIndicator.classList.remove('hidden');
                setTimeout(() => {
                    typingIndicator.classList.add('hidden');
                    mobileTypingIndicator.classList.add('hidden');
                }, 3000);
            }

            function simulateReply(conversation) {
                const replies = [
                    'Thanks for your message!',
                    'I\'ll get back to you soon.',
                    'That sounds interesting!',
                    'I agree with you.',
                    'Let me think about that.'
                ];
                
                const reply = replies[Math.floor(Math.random() * replies.length)];
                
                // Add message
                conversation.messages.push({
                    sender: conversation.with,
                    content: reply,
                    time: 'Just now'
                });
                
                conversation.lastMessage = reply;
                conversation.time = 'Just now';
                
                // Render
                renderChatMessages(conversation.messages);
                renderMobileChatMessages(conversation.messages);
                renderConversations();
                renderMobileConversations();
            }

            // Mobile menu functionality
            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
                isMobileMenuOpen = !isMobileMenuOpen;
            });

            mobileHomeBtn.addEventListener('click', function() {
                // Show threads list
                threadDetail.classList.add('hidden');
                document.getElementById('threads-container').parentElement.classList.remove('hidden');
                mobileMessagesPanel.classList.add('hidden');
                mobileChatPanel.classList.add('hidden');
                
                // Update active button
                updateMobileNavActive(this);
            });

            mobileCategoriesBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
                isMobileMenuOpen = !isMobileMenuOpen;
                
                // Update active button
                updateMobileNavActive(this);
            });

            mobileMessagesBtn.addEventListener('click', function() {
                if (!currentUser) {
                    showNotification('Please login to view messages.', 'error');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                mobileMessagesPanel.classList.remove('hidden');
                mobileChatPanel.classList.add('hidden');
                renderMobileConversations();
                
                // Update active button
                updateMobileNavActive(this);
            });

            closeMobileMessages.addEventListener('click', function() {
                mobileMessagesPanel.classList.add('hidden');
            });

            mobileProfileBtn.addEventListener('click', function() {
                if (!currentUser) {
                    showNotification('Please login to view your profile.', 'error');
                    loginModal.classList.remove('hidden');
                    return;
                }
                
                editProfileBtn.click();
                
                // Update active button
                updateMobileNavActive(this);
            });

            function updateMobileNavActive(activeBtn) {
                // Reset all buttons
                const mobileNavBtns = [mobileHomeBtn, mobileCategoriesBtn, mobileNewPostBtn, mobileMessagesBtn, mobileProfileBtn];
                mobileNavBtns.forEach(btn => {
                    btn.classList.remove('text-blue-600');
                    btn.classList.add('text-gray-500');
                });
                
                // Set active button
                activeBtn.classList.remove('text-gray-500');
                activeBtn.classList.add('text-blue-600');
            }

            // Helper functions
            function getInitials(name) {
                return name.split(' ')
                    .map(part => part.charAt(0))
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
            }

            function getCategoryName(category) {
                const names = {
                    general: 'General Discussion',
                    tech: 'Technology',
                    random: 'Random',
                    help: 'Help & Support'
                };
                return names[category] || category;
            }

            function findThreadById(id) {
                for (const category in categories) {
                    const thread = categories[category].threads.find(t => t.id == id);
                    if (thread) return thread;
                }
                return null;
            }

            function showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-md shadow-lg z-50 message-appear ${
                    type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                }`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            function populateMessageRecipients() {
                messageRecipient.innerHTML = '<option value="">Select a user</option>';
                registeredUsers.forEach(user => {
                    if (!currentUser || user.nickname !== currentUser.nickname) {
                        const option = document.createElement('option');
                        option.value = user.nickname;
                        option.textContent = user.nickname;
                        messageRecipient.appendChild(option);
                    }
                });
            }

            // Render functions
            function renderThreads() {
                threadsContainer.innerHTML = '';
                
                if (!categories[currentCategory] || categories[currentCategory].threads.length === 0) {
                    threadsContainer.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                            <p class="text-lg font-medium">No posts yet</p>
                            <p class="mt-1">Be the first to start a discussion!</p>
                        </div>
                    `;
                    return;
                }
                
                categories[currentCategory].threads.forEach(thread => {
                    const threadEl = document.createElement('div');
                    threadEl.className = 'bg-white border border-gray-100 rounded-lg p-4 hover:shadow-md transition duration-200 thread-card';
                    threadEl.innerHTML = `
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">${thread.title}</h3>
                        <div class="flex items-center space-x-2 mb-3">
                            <div class="w-6 h-6 rounded-full bg-${thread.authorColor} flex items-center justify-center text-xs text-white">${thread.authorInitials}</div>
                            <span class="text-sm text-gray-600">${thread.author}</span>
                            <span class="text-sm text-gray-400">• ${thread.time}</span>
                        </div>
                        <p class="text-gray-700 mb-3 line-clamp-2">${thread.content}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">${thread.replies.length} ${thread.replies.length === 1 ? 'reply' : 'replies'}</span>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium view-thread" data-thread-id="${thread.id}">View Post</button>
                        </div>
                    `;
                    
                    threadsContainer.appendChild(threadEl);
                });
                
                // Add event listeners to view thread buttons
                document.querySelectorAll('.view-thread').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const threadId = this.getAttribute('data-thread-id');
                        showThreadDetail(threadId);
                    });
                });
            }

            function renderReplies(replies) {
                threadReplies.innerHTML = '';
                
                if (replies.length === 0) {
                    threadReplies.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>No replies yet. Be the first to reply!</p>
                        </div>
                    `;
                    return;
                }
                
                replies.forEach(reply => {
                    const replyEl = document.createElement('div');
                    replyEl.className = 'border-b border-gray-100 pb-4 message-appear';
                    replyEl.innerHTML = `
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-6 h-6 rounded-full bg-${reply.authorColor} flex items-center justify-center text-xs text-white">${reply.authorInitials}</div>
                            <span class="font-medium text-gray-800">${reply.author}</span>
                            <span class="text-sm text-gray-500">• ${reply.time}</span>
                        </div>
                        <div class="pl-8">
                            <p class="text-gray-700">${reply.content}</p>
                        </div>
                    `;
                    
                    threadReplies.appendChild(replyEl);
                });
            }

            function renderConversations() {
                conversationsList.innerHTML = '';
                
                if (!currentUser) {
                    conversationsList.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>Please login to view messages</p>
                        </div>
                    `;
                    return;
                }
                
                if (conversations.length === 0) {
                    conversationsList.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>No conversations yet</p>
                        </div>
                    `;
                    return;
                }
                
                conversations.forEach(conversation => {
                    const conversationEl = document.createElement('div');
                    conversationEl.className = `p-2 rounded-md ${conversation.unread ? 'bg-blue-50' : 'hover:bg-gray-50'} cursor-pointer conversation-item`;
                    conversationEl.setAttribute('data-conversation-id', conversation.id);
                    conversationEl.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <div class="w-10 h-10 rounded-full bg-${conversation.withColor} flex items-center justify-center text-white">${conversation.withInitials}</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-medium text-gray-800 truncate">${conversation.with}</h3>
                                    <span class="text-xs text-gray-500">${conversation.time}</span>
                                </div>
                                <p class="text-sm text-gray-600 truncate">${conversation.lastMessage}</p>
                            </div>
                            ${conversation.unread ? '<span class="w-2 h-2 bg-blue-600 rounded-full"></span>' : ''}
                        </div>
                    `;
                    
                    conversationsList.appendChild(conversationEl);
                });
                
                // Add event listeners to conversation items
                document.querySelectorAll('.conversation-item').forEach(item => {
                    item.addEventListener('click', function() {
                        if (!currentUser) {
                            showNotification('Please login to view messages.', 'error');
                            loginModal.classList.remove('hidden');
                            return;
                        }
                        
                        const conversationId = this.getAttribute('data-conversation-id');
                        const conversation = conversations.find(c => c.id == conversationId);
                        if (conversation) {
                            openChat(conversation);
                        }
                    });
                });
            }

            function renderMobileConversations() {
                mobileConversationsList.innerHTML = '';
                
                if (!currentUser) {
                    mobileConversationsList.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>Please login to view messages</p>
                        </div>
                    `;
                    return;
                }
                
                if (conversations.length === 0) {
                    mobileConversationsList.innerHTML = `
                        <div class="text-center py-4 text-gray-500">
                            <p>No conversations yet</p>
                        </div>
                    `;
                    return;
                }
                
                conversations.forEach(conversation => {
                    const conversationEl = document.createElement('div');
                    conversationEl.className = `p-3 rounded-md ${conversation.unread ? 'bg-blue-50' : 'hover:bg-gray-50'} cursor-pointer mobile-conversation-item border-b border-gray-100`;
                    conversationEl.setAttribute('data-conversation-id', conversation.id);
                    conversationEl.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 rounded-full bg-${conversation.withColor} flex items-center justify-center text-white text-lg">${conversation.withInitials}</div>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-medium text-gray-800 truncate">${conversation.with}</h3>
                                    <span class="text-xs text-gray-500">${conversation.time}</span>
                                </div>
                                <p class="text-sm text-gray-600 truncate">${conversation.lastMessage}</p>
                            </div>
                            ${conversation.unread ? '<span class="w-3 h-3 bg-blue-600 rounded-full"></span>' : ''}
                        </div>
                    `;
                    
                    mobileConversationsList.appendChild(conversationEl);
                });
                
                // Add event listeners to mobile conversation items
                document.querySelectorAll('.mobile-conversation-item').forEach(item => {
                    item.addEventListener('click', function() {
                        if (!currentUser) {
                            showNotification('Please login to view messages.', 'error');
                            loginModal.classList.remove('hidden');
                            return;
                        }
                        
                        const conversationId = this.getAttribute('data-conversation-id');
                        const conversation = conversations.find(c => c.id == conversationId);
                        if (conversation) {
                            openChat(conversation);
                        }
                    });
                });
            }

            function renderChatMessages(messages) {
                chatMessages.innerHTML = '';
                
                messages.forEach(message => {
                    const isCurrentUser = currentUser && message.sender === currentUser.nickname;
                    const messageEl = document.createElement('div');
                    messageEl.className = `flex ${isCurrentUser ? 'justify-end' : 'justify-start'} message-appear`;
                    
                    messageEl.innerHTML = `
                        <div class="max-w-[75%] ${isCurrentUser ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'} rounded-lg px-3 py-2">
                            <p>${message.content}</p>
                            <span class="text-xs ${isCurrentUser ? 'text-blue-200' : 'text-gray-500'} block text-right mt-1">${message.time}</span>
                        </div>
                    `;
                    
                    chatMessages.appendChild(messageEl);
                });
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function renderMobileChatMessages(messages) {
                mobileChatMessages.innerHTML = '';
                
                messages.forEach(message => {
                    const isCurrentUser = currentUser && message.sender === currentUser.nickname;
                    const messageEl = document.createElement('div');
                    messageEl.className = `flex ${isCurrentUser ? 'justify-end' : 'justify-start'} message-appear`;
                    
                    messageEl.innerHTML = `
                        <div class="max-w-[75%] ${isCurrentUser ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'} rounded-lg px-3 py-2">
                            <p>${message.content}</p>
                            <span class="text-xs ${isCurrentUser ? 'text-blue-200' : 'text-gray-500'} block text-right mt-1">${message.time}</span>
                        </div>
                    `;
                    
                    mobileChatMessages.appendChild(messageEl);
                });
                
                // Scroll to bottom
                mobileChatMessages.scrollTop = mobileChatMessages.scrollHeight;
            }

            // Initialize
            init();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96661eb7d4524ed3',t:'MTc1MzcyMzk5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
